<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Meta and responsive setup -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Campus Hub - Events Calendar</title>
  
  <!-- Tailwind CSS for styling -->
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 p-4">
  <div class="max-w-4xl mx-auto">
    <h1 class="text-2xl font-bold mb-4">Events Calendar</h1>

    <!-- Add Event Form (with client-side validation) -->
    <form id="eventForm" class="space-y-4 bg-white p-4 shadow rounded mb-6">
      <h2 class="text-lg font-semibold">Add New Event (Validation Demo)</h2>

      <!-- Title Field -->
      <div>
        <label class="block mb-1">Event Title</label>
        <input type="text" id="eventTitle" class="w-full p-2 border rounded" />
        <p class="text-red-500 text-sm hidden" id="errorTitle">Title is required.</p>
      </div>

      <!-- Date Field -->
      <div>
        <label class="block mb-1">Date (YYYY-MM-DD)</label>
        <input type="date" id="eventDate" class="w-full p-2 border rounded" />
        <p class="text-red-500 text-sm hidden" id="errorDate">Please enter a valid future date.</p>
      </div>

      <!-- Category Dropdown -->
      <div>
        <label class="block mb-1">Category</label>
        <select id="eventCategory" class="w-full p-2 border rounded">
          <option value="">Select a category</option>
          <option value="Workshop">Workshop</option>
          <option value="Seminar">Seminar</option>
          <option value="Social">Social</option>
        </select>
        <p class="text-red-500 text-sm hidden" id="errorCategory">Please select a category.</p>
      </div>

      <!-- Description Field -->
      <div>
        <label class="block mb-1">Description</label>
        <textarea id="eventDescription" class="w-full p-2 border rounded"></textarea>
        <p class="text-red-500 text-sm hidden" id="errorDescription">Description is required.</p>
      </div>

      <!-- Submit Button -->
      <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">Validate</button>
    </form>

    <!--Search and Filters Section -->
    <div class="flex flex-wrap gap-4 mb-4">
      <input id="searchInput" type="text" placeholder="Search events..." class="p-2 border rounded flex-1">
      <select id="categoryFilter" class="p-2 border rounded">
        <option value="">All Categories</option>
        <option value="Workshop">Workshop</option>
        <option value="Seminar">Seminar</option>
        <option value="Social">Social</option>
      </select>
      <select id="sortOrder" class="p-2 border rounded">
        <option value="asc">Sort by Date ↑</option>
        <option value="desc">Sort by Date ↓</option>
      </select>
    </div>

    <!-- Events List Output -->
    <div id="eventsList" class="space-y-4"></div>

    <!-- Pagination Buttons -->
    <div class="mt-6 flex justify-center space-x-2" id="pagination"></div>
  </div>

  <!-- JavaScript Section -->
  <script>
    // JSON source (hosted on GitHub or MockAPI)
    const eventsUrl = "https://github.com/maramfares23/ITCS333-project-/blob/EVENT/event.json"

    // Global state variables
    let allEvents = [];
    let currentPage = 1;
    const eventsPerPage = 3;

    // DOM element references
    const searchInput = document.getElementById("searchInput");
    const categoryFilter = document.getElementById("categoryFilter");
    const sortOrder = document.getElementById("sortOrder");
    const eventsList = document.getElementById("eventsList");
    const pagination = document.getElementById("pagination");

    //Fetch events from external JSON source
    async function fetchEvents() {
      eventsList.innerHTML = "<p>Loading events...</p>"; // Show loading message
      try {
        const res = await fetch(eventsUrl); // Fetch from JSON URL
        if (!res.ok) throw new Error("Failed to fetch events."); // Handle HTTP errors
        allEvents = await res.json(); // Parse JSON array
        renderEvents(); // Display events
      } catch (err) {
        eventsList.innerHTML = `<p class="text-red-600">Error: ${err.message}</p>`; // Show error
      }
    }

    //Render filtered, sorted, and paginated events
    function renderEvents() {
      // Apply search and category filter
      let filtered = allEvents.filter(e =>
        e.name.toLowerCase().includes(searchInput.value.toLowerCase()) &&
        (!categoryFilter.value || e.category === categoryFilter.value)
      );

      // Sort by date
      filtered.sort((a, b) =>
        sortOrder.value === "asc"
          ? new Date(a.date) - new Date(b.date)
          : new Date(b.date) - new Date(a.date)
      );

      // Pagination logic
      const totalPages = Math.ceil(filtered.length / eventsPerPage);
      const start = (currentPage - 1) * eventsPerPage;
      const pageItems = filtered.slice(start, start + eventsPerPage);

      // Render each event as a card
      eventsList.innerHTML = pageItems.map(event => `
        <div class="p-4 bg-white shadow rounded">
          <h2 class="text-xl font-semibold">${event.name}</h2>
          <p class="text-sm text-gray-600">${event.date} | ${event.category}</p>
          <p class="mt-2">${event.description}</p>
        </div>
      `).join("");

      // Render pagination controls
      renderPagination(totalPages);
    }

    //Build pagination buttons
    function renderPagination(totalPages) {
      pagination.innerHTML = ""; // Clear old buttons
      for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement("button");
        btn.textContent = i;
        btn.className = `px-3 py-1 rounded ${i === currentPage ? 'bg-blue-500 text-white' : 'bg-white border'}`;
        btn.addEventListener("click", () => {
          currentPage = i;
          renderEvents();
        });
        pagination.appendChild(btn);
      }
    }

    //Event listeners for filters and search
    searchInput.addEventListener("input", () => { currentPage = 1; renderEvents(); });
    categoryFilter.addEventListener("change", () => { currentPage = 1; renderEvents(); });
    sortOrder.addEventListener("change", () => { currentPage = 1; renderEvents(); });

    //Validate the Add Event form without submitting it
    document.getElementById("eventForm").addEventListener("submit", function (e) {
      e.preventDefault(); // Stop form from submitting

      // Get field values
      const title = document.getElementById("eventTitle");
      const date = document.getElementById("eventDate");
      const category = document.getElementById("eventCategory");
      const description = document.getElementById("eventDescription");

      // Get error message elements
      const errorTitle = document.getElementById("errorTitle");
      const errorDate = document.getElementById("errorDate");
      const errorCategory = document.getElementById("errorCategory");
      const errorDescription = document.getElementById("errorDescription");

      let valid = true; // Form validation flag

      //Title must not be empty
      if (title.value.trim() === "") {
        errorTitle.classList.remove("hidden");
        valid = false;
      } else {
        errorTitle.classList.add("hidden");
      }

      //Date must be a valid future date
      const today = new Date().toISOString().split("T")[0]; // Get today's date as string
      if (!date.value || date.value < today) {
        errorDate.classList.remove("hidden");
        valid = false;
      } else {
        errorDate.classList.add("hidden");
      }

      //Category must be selected
      if (!category.value) {
        errorCategory.classList.remove("hidden");
        valid = false;
      } else {
        errorCategory.classList.add("hidden");
      }

      //Description must not be empty
      if (description.value.trim() === "") {
        errorDescription.classList.remove("hidden");
        valid = false;
      } else {
        errorDescription.classList.add("hidden");
      }

      //If everything is valid
      if (valid) {
        alert("Form is valid! You can now submit this to the backend.");
      }
    });

    //Initial fetch on page load
    fetchEvents();
  </script>
</body>
</html>
